<style>
@import url('https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap');

body { margin: 0; }
pre { font: 16px 'Fira Mono', monospace; line-height: 1.5; margin: 0; padding: 2rem }
pre { background-color: #f9fef5; color: #181a19; }

pre .comment { color: #94b996; font-style: italic; }
pre .keyword,
pre .string,
pre .number,
pre .nil,
pre .boolean { color: #8e9144; }
pre .symbol.special-symbol,
pre .symbol.macro-symbol,
pre .symbol.global-symbol { color: #448f22; font-weight: bold; }
</style><pre>
<span class="nonmatching "></span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">scan</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="symbol ">text</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">var</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="number ">1</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">var</span><span class="nonmatching "> </span><span class="symbol ">last-matching-at</span><span class="nonmatching "> </span><span class="number ">0</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">local</span><span class="nonmatching "> </span><span class="symbol ">text-length</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">string.len</span><span class="nonmatching "> </span><span class="symbol ">text</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">at-eof?</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">></span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="symbol ">text-length</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">yield-buffered-nonmatching</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol macro-symbol">when</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">&lt;</span><span class="nonmatching "> </span><span class="number ">0</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">-</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="symbol ">last-matching-at</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
      </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">coroutine.yield</span><span class="nonmatching "> </span><span class="bracket ">{</span><span class="nonmatching "></span><span class="keyword ">:kind</span><span class="nonmatching "> </span><span class="nil ">nil</span><span class="nonmatching ">
                        </span><span class="keyword ">:value</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">string.sub</span><span class="nonmatching "> </span><span class="symbol ">text</span><span class="nonmatching ">
                                           </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">+</span><span class="nonmatching "> </span><span class="symbol ">last-matching-at</span><span class="nonmatching "> </span><span class="number ">1</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
                                           </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">-</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="number ">1</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">}</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">yield</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="symbol ">kind</span><span class="nonmatching "> </span><span class="symbol ">matched</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">yield-buffered-nonmatching</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">coroutine.yield</span><span class="nonmatching "> </span><span class="bracket ">{</span><span class="nonmatching "></span><span class="keyword ">:kind</span><span class="nonmatching "> </span><span class="symbol ">kind</span><span class="nonmatching "> </span><span class="keyword ">:value</span><span class="nonmatching "> </span><span class="symbol ">matched</span><span class="nonmatching "></span><span class="bracket ">}</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">set</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">+</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">string.len</span><span class="nonmatching "> </span><span class="symbol ">matched</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">set</span><span class="nonmatching "> </span><span class="symbol ">last-matching-at</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">-</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="number ">1</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="symbol ">kind</span><span class="nonmatching "> </span><span class="symbol ">pattern</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol macro-symbol">case</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">string.match</span><span class="nonmatching "> </span><span class="symbol ">text</span><span class="nonmatching "> </span><span class="symbol ">pattern</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
      </span><span class="symbol ">matched</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">do</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">yield</span><span class="nonmatching "> </span><span class="symbol ">kind</span><span class="nonmatching "> </span><span class="symbol ">matched</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
                  </span><span class="boolean ">true</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "> </span><span class="comment ">; To signal success
</span><span class="nonmatching ">
  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">increment-current-index</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">set</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">+</span><span class="nonmatching "> </span><span class="symbol ">current-index</span><span class="nonmatching "> </span><span class="number ">1</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">local</span><span class="nonmatching "> </span><span class="symbol ">symbol-char</span><span class="nonmatching "> </span><span class="string ">"!%$&amp;#%*%+%-%./:&lt;=>%?%^_%w"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">while</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">not</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">at-eof?</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">or</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:comment</span><span class="nonmatching "> </span><span class="string ">"^(;[^\n]*[\n])"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:string</span><span class="nonmatching "> </span><span class="string ">"^(\"\")"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:string</span><span class="nonmatching "> </span><span class="string ">"^(\".-[^\\]\")"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:keyword</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">..</span><span class="nonmatching "> </span><span class="string ">"^(:["</span><span class="nonmatching "> </span><span class="symbol ">symbol-char</span><span class="nonmatching "> </span><span class="string ">"]+)"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:number</span><span class="nonmatching "> </span><span class="string ">"^([%+%-]?%d+[xX]?%d*%.?%d?)"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:nil</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">..</span><span class="nonmatching "> </span><span class="string ">"^(nil)[^"</span><span class="nonmatching "> </span><span class="symbol ">symbol-char</span><span class="nonmatching "> </span><span class="string ">"]"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:boolean</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">..</span><span class="nonmatching "> </span><span class="string ">"^(true)[^"</span><span class="nonmatching "> </span><span class="symbol ">symbol-char</span><span class="nonmatching "> </span><span class="string ">"]"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:boolean</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">..</span><span class="nonmatching "> </span><span class="string ">"^(false)[^"</span><span class="nonmatching "> </span><span class="symbol ">symbol-char</span><span class="nonmatching "> </span><span class="string ">"]"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:symbol</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">..</span><span class="nonmatching "> </span><span class="string ">"^(["</span><span class="nonmatching "> </span><span class="symbol ">symbol-char</span><span class="nonmatching "> </span><span class="string ">"]+)"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">attempt-match</span><span class="nonmatching "> </span><span class="keyword ">:bracket</span><span class="nonmatching "> </span><span class="string ">"^([%(%)%[%]{}])"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">increment-current-index</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">yield-buffered-nonmatching</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

</span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">with-symbol-subkind</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="symbol ">syntax</span><span class="nonmatching "> </span><span class="bracket ">{</span><span class="nonmatching "></span><span class="symbol ">&amp;as</span><span class="nonmatching "> </span><span class="symbol ">token</span><span class="nonmatching "> </span><span class="symbol special-symbol">:</span><span class="nonmatching "> </span><span class="symbol ">kind</span><span class="nonmatching "> </span><span class="symbol special-symbol">:</span><span class="nonmatching "> </span><span class="symbol ">value</span><span class="nonmatching "></span><span class="bracket ">}</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol macro-symbol">when</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">=</span><span class="nonmatching "> </span><span class="keyword ">:symbol</span><span class="nonmatching "> </span><span class="symbol ">kind</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">set</span><span class="nonmatching "> </span><span class="symbol ">token.subkind</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol macro-symbol">case</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">.</span><span class="nonmatching "> </span><span class="symbol ">syntax</span><span class="nonmatching "> </span><span class="symbol ">value</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
                         </span><span class="bracket ">{</span><span class="nonmatching "></span><span class="keyword ">:special?</span><span class="nonmatching "> </span><span class="boolean ">true</span><span class="nonmatching "></span><span class="bracket ">}</span><span class="nonmatching "> </span><span class="keyword ">:special-symbol</span><span class="nonmatching ">
                         </span><span class="bracket ">{</span><span class="nonmatching "></span><span class="keyword ">:macro?</span><span class="nonmatching "> </span><span class="boolean ">true</span><span class="nonmatching "></span><span class="bracket ">}</span><span class="nonmatching "> </span><span class="keyword ">:macro-symbol</span><span class="nonmatching ">
                         </span><span class="bracket ">{</span><span class="nonmatching "></span><span class="keyword ">:global?</span><span class="nonmatching "> </span><span class="boolean ">true</span><span class="nonmatching "></span><span class="bracket ">}</span><span class="nonmatching "> </span><span class="keyword ">:global-symbol</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
  </span><span class="symbol ">token</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

</span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">token->html</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="bracket ">{</span><span class="nonmatching "></span><span class="symbol special-symbol">:</span><span class="nonmatching "> </span><span class="symbol ">kind</span><span class="nonmatching "> </span><span class="symbol special-symbol">:</span><span class="nonmatching "> </span><span class="symbol ">subkind</span><span class="nonmatching "> </span><span class="symbol special-symbol">:</span><span class="nonmatching "> </span><span class="symbol ">value</span><span class="nonmatching "></span><span class="bracket ">}</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">let</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="symbol ">class</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">..</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">or</span><span class="nonmatching "> </span><span class="symbol ">kind</span><span class="nonmatching "> </span><span class="string ">"nonmatching"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "> </span><span class="string ">" "</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">or</span><span class="nonmatching "> </span><span class="symbol ">subkind</span><span class="nonmatching "> </span><span class="string ">""</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
        </span><span class="symbol ">escaped-value</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol macro-symbol">-></span><span class="nonmatching "> </span><span class="symbol ">value</span><span class="nonmatching ">
                          </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">string.gsub</span><span class="nonmatching "> </span><span class="string ">"&amp;"</span><span class="nonmatching "> </span><span class="string ">"&amp;amp;"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
                          </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">string.gsub</span><span class="nonmatching "> </span><span class="string ">"&lt;"</span><span class="nonmatching "> </span><span class="string ">"&amp;lt;"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">..</span><span class="nonmatching "> </span><span class="string ">"&lt;span class=\""</span><span class="nonmatching "> </span><span class="symbol ">class</span><span class="nonmatching "> </span><span class="string ">"\">"</span><span class="nonmatching "> </span><span class="symbol ">escaped-value</span><span class="nonmatching "> </span><span class="string ">"&lt;/span>"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

</span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">fn</span><span class="nonmatching "> </span><span class="symbol ">for-html</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="symbol ">syntax</span><span class="nonmatching "> </span><span class="symbol ">code</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
  </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">let</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="symbol ">tokens</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol macro-symbol">icollect</span><span class="nonmatching "> </span><span class="bracket ">[</span><span class="nonmatching "></span><span class="symbol ">token</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">coroutine.wrap</span><span class="nonmatching "> </span><span class="symbol special-symbol">#</span><span class="nonmatching "></span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">scan</span><span class="nonmatching "> </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol special-symbol">..</span><span class="nonmatching "> </span><span class="symbol ">code</span><span class="nonmatching "> </span><span class="string ">"\n"</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
                 </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol macro-symbol">->></span><span class="nonmatching "> </span><span class="symbol ">token</span><span class="nonmatching ">
                      </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol ">with-symbol-subkind</span><span class="nonmatching "> </span><span class="symbol ">syntax</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">
                      </span><span class="symbol ">token->html</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">]</span><span class="nonmatching ">
    </span><span class="bracket ">(</span><span class="nonmatching "></span><span class="symbol global-symbol">table.concat</span><span class="nonmatching "> </span><span class="symbol ">tokens</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching "></span><span class="bracket ">)</span><span class="nonmatching ">

</span><span class="bracket ">{</span><span class="nonmatching "></span><span class="symbol special-symbol">:</span><span class="nonmatching "> </span><span class="symbol ">for-html</span><span class="nonmatching "> </span><span class="keyword ">:for_html</span><span class="nonmatching "> </span><span class="symbol ">for-html</span><span class="nonmatching "></span><span class="bracket ">}</span><span class="nonmatching ">

</span>
